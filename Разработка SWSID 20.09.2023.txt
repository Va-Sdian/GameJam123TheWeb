`````````Глобальный допил множества фич №1

1. Полоска и кол-во хп игрока
2. Полоска и кол-во хп базы
3. Анимация смерти мобов
4. Экран смерти
5. По-другому сделанная рамка с кнопками (активна только кнопка выхода)
6. Текст в игре в одном шрифте


Обновления от 23.01.23
1. Добавил функционал к другим кнопкам окна
2. Добавил состояние STUN к врагу Enemy1. Оно срабатывает, когда по нему попадают жёлтыми пулями от пкм
3. Жёлтые пули наносят 0 дамага
4. Убрал поворот узла Игрока и поставил в коде градус поворота на спрайт ног
5. Добавил дополнительное перемещение камеры с движением мыши
6. Заставил Enemy поворачиваться правильно за счёт поворота спрайтов на 90 градусов
7. Враги в стане находятся 10 секунд, а затем оживают
8. Пофиксил баг со станом: теперь после выхода из стана враг возвращается в предыдущий стейт до этого
9. Реализовал нокбэк

Обновление 18.02.23:
1. Реализовал связывание, но враг только поворачивается в сторону игрока, его никак не тянет
2.1 Координаты считываются правильно для jointLine.add_point, но почему-то когда их отображает правильно ничего не рисуется, 
а когда я ставлю нулевые координаты то линия начинает рисоваться?
2.2 Вычел из координатов точек, которые добавлял, собственные координаты узла Line2D — стало отображать корректно
2.3 Но теперь рисунок линики некорректно смещается при повороте узла из-за соединения.

Обновление 21.02.23:
1. Рисунок смещался потому что соединение поворачивало врага в виде поворота всего узла врага, исправил тем что для узла
рисунка скопировал jointLine.set_deferred("rotation", но с обратным значением переменных
2. Целый день работал над тем, что делал тестовую сцену с претягиванием мышкой сначала спрайта, затем кинематикБади2д,
я это реализовал с целью понять, как заставить тела притягиваться с помощью СпрингДжоинт. Я обнаружил, что риджид бади 
работает нормально, но кинБади нет, видимо из-за физики?

Обновление 26.02.23:
1. Сделал тестового врага на основе RigidBody, благодаря этому он теперь реагирует на пружину. Двигается забавно неправильно, 
нужно будте это подкручивать, чтобы было более реалистично
2. Заменил move_and_slide на apply_central_impulse, но от так движется мгновенно, нужно менять на что-то, чтобы движение было
как раньше
3. При linear_velocity = velocity движется так, как нужно.
4. Обнаружил баг, что когда враг связан, если он всё же вплотную приближается к игроку, он выходит из стана и будучи связанным
начинает атаковать. Однако если его снова ударить станом он снова уходит в стан.

Обновление 01.03.2023:
1. Поменял определение цели у врага с замены странного определения метода bounce на распознание группы base или player
2. Когда враг отлетает на расстояние он снова переходит в стейт алайв и снова подходит к цели

Обновление 02.03.2023:
1. Добавил табличку очков справа-верху
2. В коде врага сделал func plus_one_score(): Global.score += 1, и вызов его через анимейш плеер в конце анимации смерти.
Если вызывал его в коде, то эта функция вызывалась каждый кадр, пока проигрывалась анимация смерти.
3. Централизовал камеру для главного меню
4. Подложка главного меню теперь крутится по кругу
5. Централизовал камеру в опциях и титрах


Обновление 06.04.23:
1. Реализовал связывание любых врагов
Создал функцию find_player(), где из массива группы таргет вытягивается игрок, и он в return player

Обновление 07.04.23:
1.Пофиксил "ошибку с бесконечным соединением отвязывания в коннект бади, при попадании ещё одной пули."
Сигнал enemyStunned отсылается только тогда, когда враг ни с кем не связан (PiC = false). По стандарту PiC только объявляется в узле врага, без какого-либо значения
2.Фикс "Узел врага говорит что сигнал ChangePiC не существует, хотя он объявлен в глобал сигналс"
Нужно было emit_signal через GlobalSignals, ведь там объявляется, что есть такой сигнал, а не в узле врага
3. Фикс"Узел врага два раза прогоняет соединение. Но на третий уже работает как ПиК = тру и не прогоняет, почему триггерит второй раз?"
Это было потому, что в узле BulletCapture сначала вызывался при контакте с врагом функция stunned, в котором и прогонялось связывание, а уже потом вызывалось body.PiC = PiC, которое передаёт PiC от пули к врагу. Нужно было поменять их местами
4. Создал отсоединение пружины и линии при выходе из стана
5. Создаёт "Создавать новые узлы DSpringJoint при атаке нового врага."
6.Сделал "Придумать и реализовать логику для связывания дополнительных врагов"

Обновление 11.04.23:
1. Фикс Убрать стекующиеся ошибки о повторном присоединении пружины и линии при повторном оглушении (проверить, присоединены ли они уже?)
Пофиксил с помощью is_conected

Обновление 12.04.23:
1. Переписал функционал PiC — теперь это глобальная переменная, которая отслеживает количество соединений. 
2. У игрока появилась функция PlayerIsConnectedSummCheck, которая следит за этой глобальной переменной, и при 0 назначает, что
соединений нет (false), всё остальное true.
3. Выявил баг с зацикливанием стана из-за нового функционала PiC. К сожалению, есть ещё баги:
3.1 При поочерёдном стане разных врагов, они по новой добавляют количество изменений. Пофиксил следующей строчкой
4. PiC внутри игроков теперь отслеживает, соединён враг с игроком или нет.
4.1. Почему-то стали некорректно работать поочерёдные соединения, например при попадании во врага, который был предыдущий, он
обрывает соединения с предыдущим врагом.
5. Вроде? пофиксил: Убрать ошибку Can't add child '@DSpringJoint@2' to 'Enemy2', already has a parent 'Enemy2'. (Проверкой на наличие этого родителя?)
if Dspring_instance.get_parent() == null:


16.04:
1. Не проходит присоединение врага (второй узел), выдаёт нулл??!!

19.04:
1. Пофиксил не вызвание функции у узла внутри чайлд узла. Для этого нужно было объявить этот узел как новую переменную.
@onready var wasLCE_Dspring_instance: Node2D
и присвоить ей предыдущий инстанц, через который создавался чайлд нод.
wasLCE_Dspring_instance = Dspring_instance

?Если убить врага (до того?), как он сбросит wasLCE, при стане нового врага получается ошибка (Вроде пофикшено? 04.2023)

22.04:
1. Как задавать или узнавать название узла, который спавнится через add_child?
Хз, я не разобрался, почему его не находит, я сделал просто через get_node
2.Застаненные враги следуют за курсором мыши
(2. При создании связывания указывать длину соединения равной расстоянию между связанными объектами) наверное уже и не нужно

25.04
1. Пофиксил (Начал вводить ловлю в карантин, реализовал коллизию, но не могу через код базы сменить state у застанненного врага.)
Теперь врагов можно закидывать в карантин

02.05
Реализация (Шейдеры на соударение с пулей. Разные для базы и врагов, и для игрока)
1.Добавил партиклс для:
1.1. урона базы и её уничтожения
1.2. Урон и уничтожение врага
1.3. Урон и уничтожение игрока
1.4. Партиклс обычных пуль (это было сложнее)
1.5. Партиклы на враге во время стана
1.6. Пофиксил (Самый первый стан врага с ошибкой - на него нельзя повторно повесить стан!), но теперь новая ошибка:
При повторном стане 2 врага после 3-го не получается создать дспринг инстанс у 3-го врага.

03.05
1. Методом тыка пофиксил ротацию партиклс у пуль (я не понял, это не градусы через rotation назначаются, а фигня какая-то)
2. Фикс (При повторном стане 2 врага после 3-го не получается создать дспринг инстанс у 3-го врага.)
Переписал метод с 
var Dspring_inst_preload = preload("res://scenes/Viruses/d_spring_joint.tscn")
var Dspring_instance: Node2D
Теперь ошибки с созданием инстансев нет
Пофиксил код на то, чтобы можно было связывать в любом порядке 3-х врагов (как мне пока кажется), но на 
четвёртом враге появляются "Непонятные условия соединения" 

11.05
1. Вроде пофиксил "На связывании четвёртого врага появляются "Непонятные условия соединения" 
2. Обнаружил ошибку от множества застаненных врагов, что бывает связывает одно врага с двумя разными (одновременная коллизия?),
и тогда (вроде как) при сбрасывании таймера код сохраняет LCE, так что если застанить нового врага, когда никто не в стане,
он соединится с этим последним врагом, вызывая
"Присоединение нового (третьего) врага к существующей цепочке, если последний враг не был ни к кому присоединён"
.Проверил, да, это одновременная коллизия 
3. Пофиксил благодаря идеи из чата, создал в пуле стана CoI (Count of Interactions. Количество возможного взаимодействия пули). В теории из этого можно создать 
раскачиваемый навык, чтобы можно было ловить или убивать сразу нескольких врагов

17.05:
1. Фикс "Корректное отображение хп базы - сделать, чтобы с началом игры посылался сигнал HP_Label.text о том, сколько хп у базы"
Добавил в GameWindow после присоединения сигнала вызов сигнала GlobalSignals.emit_signal("base_damage", (base.health))

23.05:
1. Создал в Global переменную, учитывающую кол-во врагов на экране. Враги сами при появлении или смерти меняют её значение, похоже на PiC


27.05:
"1. Чтобы враги двигались только по тайлмап (включаемая и выключаемая функция), и поиск пути до базы"
1. Не смог создать поиск пути через AStar, сделал через NavigationAgent, пока без переключения
2. Заметил баг, что при стане во время атаки базы и утаскивании в сторону, после разстана с любого расстояния враг снова атакует
Сразу пофиксил
2. Сохранил тайл мап, вставил в первый уровень, изменил внешний вид
3.Добавил анимацию топ-даун форума в основной гейм сцене

02.06:
1. Сделал сцену сандбокса, пока пустую без свойств
2. Переписал функцию поиска базы, чтобы не выдавало ошибок даже если её нет
2.1 Изменил в GameWindow обновление хп базы и игрока, чтобы они выполнялись только если база и игрок есть а не нулл
3. Добавил врагу VisibleOnScreenNotifier, но пока они не появляются обратно после того, как исчезают за экраном, ещё не разобрался

НУЖНО (СТАРАЯ ВЕРСИЯ, УЖЕ СИЛ НЕТ ПРОДОЛЖАТЬ, ПРОСТИТЕ :Р):
Чтобы враги двигались только по тайлмап (включаемая и выключаемая функция)
3. Границы уровней
4. Обучение для первого уровня GameWindow
5.Система переключения языка для меню и обучения
6.Система смены иконок действия в обучении в зависимости от того, используется ли контроллер или клавиатура
7. Выбор уровня сложности при начале игры
8. Система сохранения
9. События в уровне делятся на два уровня: случайные и прописанные. 
Случайные: спавн кол-ва врагов. 
Прописанные: Время уровня, Появление диалогов, сюжетных развилок
10. Создать код чтобы спрайты скрывались, когда они за пределом экрана visibility notifier
https://www.youtube.com/watch?v=lfuGLaZ3khs
Создаётся чайлд узел VisibilityNotifier2D, который издаёт сигнал, когда он выходит за пределы экрана

onready var visibility_notifier := $VisibilityNotifier2D

func _ready() -> void:
	visibility_notifier.connect("screen_entered", self, "show")
	visibility_notifier.connect("screen_exited", self, "hide")
	visible = false

Код выше перестал работать с 4.0 версии годо — изменился принцип работы visibility notifier, 
теперь он может только часть спрайтов скрывать, но не весь родительский узел, что плохо





НУЖНО (ФИНАЛЬНЫЙ РЫВОК, ЧТОБЫ ЗАБРОСИТЬ)
1. Сделать таймер на уровень
2. После окончания таймера переключение сцены на магазин
3. 2-й уровень: враги агрятся на игрока, если он подходит близко
4. 3-й уровень игрок может ходить тоже только по тайл мапу
5. Заставка "Вы победили!" и кол-во очков




12.09:
1. Починил таймер смерти
2. Подправил кнопки на меню смерти
3. Добавил в меню кнопку туториала
4. Создал пустые магазин, туториал, сцену прохождения игры
5. Пофиксил уровень 2 и 3 (они были пустыми, плюс у меня не появлялись пули, когда я добавлял только игрока/врага и буллетменеджер, оказывается на главном узле не было кода гейм-виндовс
6. Добавил таймер, но не прописал в коде уровней какое время ему выставлять, но код отчисления и высвечивания в худе я сделал

13.09
1. Запустил различный таймер на уровнях
2. Создал меню завершения уровня с кнопками на следующий уровень и в магазин
3. Пришлось писать код для кнопок для перехода на следующий уровень отдельно
4. Не работает ползунок громкости на втором и третьем уровне. ПОчему?
ПОФИКСИЛ: В узле музыки нужно было выбрать бас "музыка", а он на мастер отправлял

4.2 Не работает определение пути, если сцену запускать не отдельно, а она запускается по порядку???
Это потому, что определение таргета происходит один раз, что-то такое? Пытаюсь сделать с каждым уровнем,
заодно поставлю чтобы и игрока определяли.

4.3. При определении врага как таргета они не атакуют его, пока не подойдут вплотную к коллизии базы. Нужно прописать
коллизию игрока а не базы на атаку, и похоже чтобы она менялась в зависимости от таргета.
Не атаковали врага, потому что слой коллизии был не выбран с игроком
По той же причине атака не прекращалась, если игрок далеко отходил
ПО ТОЙ ЖЕ ПРИЧИНЕ ВРАГ НЕ СЛЕДОВАЛ ЗА ИГРОКОМ, ЗАРАЗА, Я ТАК ДОЛГО ЭТО ИСКАЛ!!


4.4 Кнопка рестарта неправильно работает (накидывает лишнее время), может время от другого уровня?
Плюс она капает даже при паузе игры
Фикс: Почему-то выставлялся метод наследование процесса "Всегда", я поставил "Наследовать", фигня какая-то
Накапывает лишнее потому-что определяет уровень неправильно. Пришлось переделать систему с глобальной переменной "Global.current_level",
я её оставил, чтобы не менять там ещё в таймерах что-то было, но теперь она определяется через 
match get_tree().current_scene.name
Так намного удобнее, я не знал что так можно

5. Сделал кнопки и варианты в магазине, но опять споткнулся на сигналах, как правильно написать, чтобы нажатия на кнопки триггерило
код в основном узле...
Вроде сделал для здоровья игрока, остаётся только на все остальные кнопки перенести, но это уже на следующие дни после смены

Сделано:
1. Сделать таймер на уровень
2. После окончания таймера переключение сцены на магазин
3. 2-й уровень: враги агрятся на игрока, если он подходит близко (сделал не так, а чтобы появлялись с 20% вероятностью враги,
которые пресследуют игрока)

15.09
1. Доделал магазин (3 продажи и 3 покупки)
2. Пофиксил неравномерную полоску жизни базы (назначил максимальное значение и процент, перевожу текущее здоровье в процент от максимума и направляю
это в процент насколько показывается полоска жизни)
3. Долго фиксил то, что не находилось здоровье игрока через узел глобал GLobal.player.health. Видимо во время исполнения ready в GUI значение здоровья ещё не 
успевает посчитаться, пришлось обходить через установлении константы минимального здоровья в узле игрока,
в глобал player_health = player.min_health + player_health_bonus
В гуи
	if Global.player != null:
		full_player_health = Global.player_health
		player_health_1_percent = float(full_player_health)/100

4. СДЕЛАЛ (2-й уровень: враги агрятся на игрока, если он подходит близко, но возвращаются к атаке на базу, если игрок отходит)
!Есть баг, что когда враг атакует базу, а игрок подходит, враг начинает атаковать игрока, и если игрок отходит, враг не всегда
возвращается к атаке, а начинает тыкаться в базу

5. Если я сделаю так, что когда игрок вылезает за пределы тайлмапов и будет останавливаться, то он не сможет вернутсья обратно. И стены не сделать из-за специфики.
Я пришёл к такому решению, и оно, возможно, интерплерируется и на врагов, что даст возможность тактике выбрасывания их за пределы паутины:
Хождение по сетке даёт буст к скорости (т.е. движение будет в тех значениях, в которых оно сейчас), а вне сетки все будут сильно замедляться.

16.09
1. Я сделал обнаружение игроком тайлсетов, но много вопросов я не понимаю
Я создал арену2д и обнаружение объектов на слое 6, который выделил под тайлмап
В тайлмапе создал физический слой, располагаемый на слое 6, НО
Если я ставлю на другие, предыдущие слои, то тайлмап начинает выступать как стена, и я не знаю почему? Возможно это базовые
настройки в физических телах2д, что коллизия настраивается именно так при взаимодействии, и её можно было отключить, но
я не знаю как это сделать. Хорошо, что я обошёл это хотя бы таким способом.
Теперь остаётся привинтить обнаружение выхода из тайлсетов, или может есть постоянная коллизия?
И изменение скорости при нахождении на паутине тайлсетов


17.09
1. Сделал определение игроком группы тайлмапа (хотел сделать через определение класса, но я не понял, как это сделать:( )
2. Сделал переменную var outOfTiLeMapFriction = 80, которая вычитается из скорости игрока. Когда определяется коллизия с тайлмапом,
эта переменная = 0, когда определяется выход из коллизии, переменная снова становится = 80.
3. Скопировал всё это во врага, только у него скорость MAX_SPEED = 70, и outOfTiLeMapFriction = 45
4. Разбирался с сохранениями, создал простой код создания файла сохранения и его загрузки, но у меня не получается 
запихнуть в него данные, а точнее сохранить словарь (переменные как-то получалось, не понял как).
5. Сделал покрасивше лидербоард, сцену победы
6. В сцене победы добавил строку, куда вбивать своё имя, кнопку сохранения.

СДЕЛАЛ 
(4. 3-й уровень игрок может ходить тоже только по тайл мапу
5. Заставка "Вы победили!" и кол-во очков)


19.09
1 . Я не понимаю, почему оно работает, но оно работает
Чтобы в сохранённый файл писались переменные, нужно перед ними писать @export
Я думал это свойство только для упрощённой работы и отображения в интерфейсе годо
2. Добавил проверку существует ли сохранённый файл через FileAccess.file_exist, также исправил баг, что сохранения перезаписывались
при перезапуске игры

20.09
1. Каким-то образом доделал лидербоард, все мозги потерял, вообще не помнил, как оперировать с словарями, списками и стрингс. Да и сейчас не помню,
но синтаксис годо от питона отличается тут, что мне только доставило больше проблем.
2. Доделал кнопки, сортировку, предупреждение удаления лидерборда.
3. Пришлось переделать код на обновлении отображения здоровья базы и игрока, т.к. при смене сцен функция _ready почему-то не запускается, и я не знаю почему.
4. Создал жёлтого и красного врага, но почему-то у них сбивается навигация, хотя я код не трогал, не понимаю почему???
5. Пофиксил громкие звуки и музыку смери - не та шина была
6.Проблемы с навигацией жёлтых и красных врагов. У них теряется таргет при выходе из арго.
У красного врага пропустил строчку primal_target = target в рандомном установлении врага


СДЕЛАЛ 
(6. Лидербоард 
Разобраться, как заставить при сохранении файла сохранять там данные
1. Жёлтые враги - не станятся, игрок получает урон при попытке стана
2. Полностью красно-пурпурные враги - медленные и живучие
)


22.09 НАЧАЛО БАГ ФИКСОВ
1. Поменял текст на 3 страничке туториала, убрав лишнюю the
2. Обновил спрайты здоровья, поставив те, что скинул Краб
3. Добавил ключи на включёной visible в анимации врагов, чтобы предотвратить странный баг невидимости, на который
наткнулся Краб
4. Исправил баг с зависанием после смерти и возвращением в меню, добавив к кнопке перехода в меню get_tree().paused = false
5. Вроде исправил баг с сохранением очков при рестарте, добавив переменную Global.previous_score
Нужно ещё потестить

Бонус:



Нужно сделать:


!Есть баг, что когда враг атакует базу, а игрок подходит, враг начинает атаковать игрока, и если игрок отходит, враг не всегда
возвращается к атаке, а начинает тыкаться в базу
То же самое со станом. 
Судя по всему это из-за того, что стейт атаки сменяется на стейт алайв, а не продолжается на стейт атаки. ДОлжно помочь was_state
Не, не помогло, к тому же ломает логику. 
Попробую добавить проверку 


